---
title: "Site Exploitation Territories"
author: "Dirk Seidensticker"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Site Exploitation Territories}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

# Introduction

...

# Overview of features


## Load libraries

```{r, warning=FALSE, results='hide', message=FALSE}
library(SiteExploitationTerritories)
```


## Loading Data

```{r}
dem <- SiteExploitationTerritories::dem
slope = ''
pts <- SiteExploitationTerritories::pts
```


## If necessary: croping the DEM using the buffer()-function

The DEM will be cropped to an extent of 5 km around the sites.

```{r, fig.show = 'hold', fig.cap = "Cropped DEM"}
dem.croped <- BufferCrop(pts = pts, dem = dem, extent = 5)
plot(dem.croped)
```

## Using the Site Exploitation Territories Function

```{r}
# Create Environment for multi-core computation
library(doParallel)
library(parallel)
cl <- makeCluster(detectCores() - 1)
print(cl)
registerDoParallel(cl)
```


```{r}
start.time <- Sys.time()
a <- SiteExploitationTerritories(pts = pts,
                                dem = dem,
                                slope = slope,
                                epsg = 31467)
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken
```

```{r, fig.show='hold', fig.cap = "Time-Cost Raster and Contour Lines for the first Site"}
# view the output
site <- 1

plot(a[[site]][[1]]) #  plot the Time-Cost Raster
plot(a[[site]][[2]], add = TRUE) # plot the Contour Lines
```

## Save the output
```{r, eval=FALSE}
for (i in 1:length(a)) {
  TCR = paste("../../output/Site", i, "TimeCostRaster", sep = "_")
  CTL = paste("../../output/Site", i, "ContourLines", sep = "_")
  rdt = "ascii"

  writeRaster(a[[i]][[1]], TCR, format = rdt, overwrite = TRUE) # write time cost raster
  shapefile(a[[i]][[2]], filename = CTL, overwrite = TRUE) # write contourlines shapefile
}
```
